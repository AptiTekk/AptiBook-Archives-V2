<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of AptiBook, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<div class="container">
    <ol class="breadcrumb">
        <li><a [routerLink]="['', 'secure']">Home</a></li>
        <li class="active">My Account</li>
    </ol>

    <div class="row">
        <div class="col-xs-12 col-md-6">
            <form (submit)="onPersonalInformationSubmit()">
                <panel [type]="'primary'" [title]="'Personal Information'">
                    <panel-body>
                        <alert #errorAlert [severity]="'danger'"></alert>

                        <alert #personalInfoAlert [severity]="'info'"></alert>

                        <div class="form-group">
                            <label for="emailAddressField">Email Address:</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-at"></i>
                                </div>
                                <input name="emailAddress" id="emailAddressField" class="form-control"
                                       [ngModel]="user.emailAddress"
                                       readonly>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="firstNameField">First Name:</label>
                                    <input name="firstName"
                                           id="firstNameField"
                                           class="form-control"
                                           [(ngModel)]="user.firstName"
                                           maxlength="30"
                                           pattern="[^<>;=]*"
                                           oninvalid="setCustomValidity('These characters are not allowed: < > ; =')"
                                           onchange="try{setCustomValidity('')}catch(e){}">
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="lastNameField">Last Name:</label>
                                    <input name="lastName"
                                           id="lastNameField"
                                           class="form-control"
                                           [(ngModel)]="user.lastName"
                                           maxlength="30"
                                           pattern="[^<>;=]*"
                                           oninvalid="setCustomValidity('These characters are not allowed: < > ; =')"
                                           onchange="try{setCustomValidity('')}catch(e){}">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumberField">Phone Number:</label>
                            <div class="input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-phone"></i>
                        </span>
                                <input name="phoneNumber"
                                       id="phoneNumberField"
                                       class="form-control"
                                       [(ngModel)]="user.phoneNumber"
                                       maxlength="30"
                                       pattern="[^<>;=]*"
                                       oninvalid="setCustomValidity('These characters are not allowed: < > ; =')"
                                       onchange="try{setCustomValidity('')}catch(e){}">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="locationField">Location:</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-map-marker"></i>
                                </div>
                                <input name="location"
                                       id="locationField"
                                       class="form-control"
                                       [(ngModel)]="user.location"
                                       maxlength="250"
                                       pattern="[^<>;=]*"
                                       oninvalid="setCustomValidity('These characters are not allowed: < > ; =')"
                                       onchange="try{setCustomValidity('')}catch(e){}">
                            </div>
                        </div>
                    </panel-body>
                    <panel-footer>
                        <button class="btn btn-primary"
                                disabled="{{personalInfoAlert.isDisplayed() || errorAlert.isDisplayed()  || !doPasswordsMatch() ? 'disabled' : null}}">
                            Save Changes
                        </button>
                    </panel-footer>
                </panel>
            </form>

            <form (submit)="onChangePasswordSubmit()">
                <panel [type]="'primary'" [title]="'Change Password'">
                    <panel-body>

                        <alert #passwordsInfoAlert [severity]="'info'"></alert>

                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="newPasswordField">New Password:</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-asterisk"></i>
                                        </div>
                                        <input type="password" name="newPassword" id="newPasswordField"
                                               class="form-control"
                                               [(ngModel)]="user.newPassword" maxlength="30">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="confirmPasswordField">Confirm Password:</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-asterisk"></i>
                                        </div>
                                        <input type="password" name="confirmPassword" id="confirmPasswordField"
                                               class="form-control" [(ngModel)]="user.confirmPassword" maxlength="30">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </panel-body>
                    <panel-footer>
                        <button class="btn btn-primary"
                                disabled="{{passwordsInfoAlert.isDisplayed() || errorAlert.isDisplayed() || !doPasswordsMatch() || !user.newPassword ? 'disabled' : null}}">
                            Save Changes
                        </button>
                        <div *ngIf="!doPasswordsMatch()" style="display: inline-block; color: darkred">The Passwords do
                            not match!
                        </div>
                    </panel-footer>
                </panel>
            </form>
        </div>
        <div class="col-xs-12 col-md-4">

            <div class="row">
                <div class="col-xs-12" *ngIf="user.admin || user.userGroups.length > 0">
                    <panel [type]="'primary'" [title]="'Assigned Groups'">
                        <panel-body>
                            <div *ngIf="user.admin">
                                <p>The admin account is automatically granted full permissions. No Groups need to be
                                    assigned.</p>
                            </div>
                            <div *ngIf="!user.admin">
                                <p style="font-weight: bold">Your assigned groups are highlighted.</p>
                                <tree [userGroup]="rootUserGroup" [selectable]="false" [dragAndDrop]="false"
                                      [higlightedUserGroups]="user.userGroups"></tree>
                            </div>
                        </panel-body>
                    </panel>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <panel [type]="'primary'" [title]="'Email Notification Preferences'">
                        <panel-body>

                        </panel-body>
                    </panel>
                </div>
            </div>

        </div>
    </div>

</div>