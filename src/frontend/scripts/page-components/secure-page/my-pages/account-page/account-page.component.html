<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of AptiBook, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<div class="container">
    <ol class="breadcrumb">
        <li><a [routerLink]="['', 'secure']">Home</a></li>
        <li class="active">My Account</li>
    </ol>

    <div class="row">
        <div class="col-xs-12 col-md-6">
            <form [formGroup]="personalInformation" (submit)="onPersonalInformationSubmit()">
                <panel [type]="'primary'" [title]="'Personal Information'">
                    <panel-body>
                        <alert #errorAlert [severity]="'danger'"></alert>

                        <alert #personalInfoAlert [severity]="'info'"></alert>

                        <div class="form-group">
                            <label for="emailAddressField">Email Address:</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-at"></i>
                                </div>
                                <input name="emailAddress" id="emailAddressField" class="form-control"
                                       [value]="user.emailAddress"
                                       readonly>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group"
                                     [class.has-error]="(personalInformation.controls['firstName'].touched || personalInformation.controls['firstName'].dirty) && personalInformation.controls['firstName'].invalid">
                                    <label for="firstNameField" class="control-label">First Name:</label>
                                    <input formControlName="firstName"
                                           id="firstNameField"
                                           class="form-control">
                                    <alert [severity]="'danger'"
                                           [displayed]="(personalInformation.controls['firstName'].touched || personalInformation.controls['firstName'].dirty) && personalInformation.controls['firstName'].invalid"
                                           [message]="
                                           personalInformation.controls['firstName'].hasError('maxlength') ? 'This must be 30 characters or less.'
                                           : 'These characters are not allowed:  < > ; ='"></alert>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group"
                                     [class.has-error]="(personalInformation.controls['lastName'].touched || personalInformation.controls['lastName'].dirty) && personalInformation.controls['lastName'].invalid">
                                    <label for="lastNameField">Last Name:</label>
                                    <input formControlName="lastName"
                                           id="lastNameField"
                                           class="form-control">
                                    <alert [severity]="'danger'"
                                           [displayed]="(personalInformation.controls['lastName'].touched || personalInformation.controls['lastName'].dirty) && personalInformation.controls['lastName'].invalid"
                                           [message]="
                                           personalInformation.controls['lastName'].hasError('maxlength') ? 'This must be 30 characters or less.'
                                           : 'These characters are not allowed:  < > ; ='"></alert>
                                </div>
                            </div>
                        </div>

                        <div class="form-group"
                             [class.has-error]="(personalInformation.controls['phoneNumber'].touched || personalInformation.controls['phoneNumber'].dirty) && personalInformation.controls['phoneNumber'].invalid">
                            <label for="phoneNumberField" class="control-label">Phone Number:</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-phone"></i>
                                </div>
                                <input formControlName="phoneNumber"
                                       id="phoneNumberField"
                                       class="form-control">
                            </div>
                            <alert [severity]="'danger'"
                                   [displayed]="(personalInformation.controls['phoneNumber'].touched || personalInformation.controls['phoneNumber'].dirty) && personalInformation.controls['phoneNumber'].invalid"
                                   [message]="
                                           personalInformation.controls['phoneNumber'].hasError('maxlength') ? 'This must be 30 characters or less.'
                                           : 'These characters are not allowed:  < > ; ='"></alert>
                        </div>

                        <div class="form-group"
                             [class.has-error]="(personalInformation.controls['location'].touched || personalInformation.controls['location'].dirty) && personalInformation.controls['location'].invalid">
                            <label for="locationField">Location:</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-map-marker"></i>
                                </div>
                                <input formControlName="location"
                                       id="locationField"
                                       class="form-control">
                            </div>
                            <alert [severity]="'danger'"
                                   [displayed]="(personalInformation.controls['location'].touched || personalInformation.controls['location'].dirty) && personalInformation.controls['location'].invalid"
                                   [message]="
                                           personalInformation.controls['location'].hasError('maxlength') ? 'This must be 250 characters or less.'
                                           : 'These characters are not allowed:  < > ; ='"></alert>
                        </div>
                    </panel-body>
                    <panel-footer>
                        <button class="btn btn-primary"
                                disabled="{{personalInformation.invalid || personalInfoAlert.isDisplayed() || errorAlert.isDisplayed()  || !doPasswordsMatch() ? 'disabled' : null}}">
                            Save Changes
                        </button>
                    </panel-footer>
                </panel>
            </form>

            <form (submit)="onChangePasswordSubmit()">
                <panel [type]="'primary'" [title]="'Change Password'">
                    <panel-body>

                        <alert #passwordsInfoAlert [severity]="'info'"></alert>

                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="newPasswordField">New Password:</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-asterisk"></i>
                                        </div>
                                        <input type="password" name="newPassword" id="newPasswordField"
                                               class="form-control"
                                               [(ngModel)]="user.newPassword" maxlength="30">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <div class="form-group">
                                    <label for="confirmPasswordField">Confirm Password:</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-asterisk"></i>
                                        </div>
                                        <input type="password" name="confirmPassword" id="confirmPasswordField"
                                               class="form-control" [(ngModel)]="user.confirmPassword" maxlength="30">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </panel-body>
                    <panel-footer>
                        <button class="btn btn-primary"
                                disabled="{{personalInformation.invalid || passwordsInfoAlert.isDisplayed() || errorAlert.isDisplayed() || !doPasswordsMatch() || !user.newPassword ? 'disabled' : null}}">
                            Save Changes
                        </button>
                        <div *ngIf="!doPasswordsMatch()" style="display: inline-block; color: darkred">
                            The Passwords do not match!
                        </div>
                    </panel-footer>
                </panel>
            </form>
        </div>
        <div class="col-xs-12 col-md-4">

            <div class="row">
                <div class="col-xs-12" *ngIf="user.admin || user.userGroups.length > 0">
                    <panel [type]="'primary'" [title]="'Assigned Groups'">
                        <panel-body>
                            <div *ngIf="user.admin">
                                <p>The admin account is automatically granted full permissions. No Groups need to be
                                    assigned.</p>
                            </div>
                            <div *ngIf="!user.admin">
                                <p style="font-weight: bold">Your assigned groups are highlighted.</p>
                                <tree [userGroup]="rootUserGroup" [selectable]="false" [dragAndDrop]="false"
                                      [higlightedUserGroups]="user.userGroups"></tree>
                            </div>
                        </panel-body>
                    </panel>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <panel [type]="'primary'" [title]="'Email Notification Preferences'">
                        <panel-body>

                        </panel-body>
                    </panel>
                </div>
            </div>

        </div>
    </div>

</div>