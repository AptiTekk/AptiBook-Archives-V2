<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of AptiBook, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<div class="row">
	<div class="col-xs-12 col-md-3">
		<div class="btn-toolbar">
			<button class="btn btn-primary">
				Add New User Group
			</button>
		</div>
		<hr/>
		<panel [type]="'primary'"
			   [title]="'Select a User Group'">
			<panel-body>
				<tree [selectable]="true"
					  [dragAndDrop]="true"
					  (selected)="onUserGroupSelected()"
					  [(ngModel)]="selectedUserGroups">
				</tree>
			</panel-body>
			<panel-footer>
				Drag and drop Groups to re-arrange them.
			</panel-footer>
		</panel>
	</div>
	<div class="col-xs-12 col-md-9">
		<div class="btn-toolbar">
			<button class="btn btn-danger"
					[disabled]="!selectedUserGroup"
					(click)="userGroupDeleteConfirm.open()">
				Delete User Group
			</button>
		</div>
		<hr/>
		<div class="row">
			<div class="col-xs-12 col-md-4">
				<form [formGroup]="userGroupDetailsFormGroup">
					<panel [type]="'primary'"
						   [title]="'User Group Details'">
						<panel-body>
							<alert #detailsInfoAlert
								   [severity]="'info'"></alert>
							<alert #detailsDangerAlert
								   [severity]="'danger'"></alert>
							<form-group [control]="userGroupDetailsFormGroup?.controls.name"
										[label]="'Name'"
										[readOnly]="!editingDetails"
										[errorMessages]="
											{
											pattern: 'These characters are not allowed:  < > ; =',
											maxlength: 'This must be 30 characters or less.'
											}">
							</form-group>
						</panel-body>
						<panel-footer>
							<span *ngIf="!selectedUserGroup">Select a User Group by clicking on it.</span>
							<button class="btn btn-default"
									*ngIf="selectedUserGroup && !editingDetails"
									(click)="onEditUserGroupDetails()">
								Edit Details
							</button>
							<button class="btn btn-primary"
									*ngIf="editingDetails"
									(click)="onSaveUserGroupDetails()"
									[disabled]="userGroupDetailsFormGroup.invalid">
								Save Changes
							</button>
							<button class="btn btn-default"
									*ngIf="editingDetails"
									(click)="onCancelUserGroupDetails()">
								Cancel
							</button>
						</panel-footer>
					</panel>
				</form>
			</div>
			<div class="col-xs-12 col-md-8">
				<panel [type]="'primary'"
					   [title]="'Assigned Users'">
					<panel-body>
						<datatable [selectableRows]="true"
								   (rowSelected)="onUserSelected(selectedUserGroup?.users[$event])"
								   (rowDeselected)="onUserDeselected()"
								   [bodyHeight]="'500px'">
							<datatable-column [orderable]="false"
											  [width]="'30px'">
								<datatable-cell *ngFor="let user of selectedUserGroup?.users">
									<user-image [user]="user"
												[width]="'30px'">
									</user-image>
								</datatable-cell>
							</datatable-column>
							<datatable-column [title]="'Email Address'">
								<datatable-cell *ngFor="let user of selectedUserGroup?.users">
									{{user.emailAddress}}
								</datatable-cell>
							</datatable-column>
							<datatable-column [title]="'First Name'">
								<datatable-cell *ngFor="let user of selectedUserGroup?.users">
									{{user.firstName}}
								</datatable-cell>
							</datatable-column>
							<datatable-column [title]="'Last Name'">
								<datatable-cell *ngFor="let user of selectedUserGroup?.users">
									{{user.lastName}}
								</datatable-cell>
							</datatable-column>
							<datatable-column [title]="'Assigned User Groups'">
								<datatable-cell *ngFor="let user of selectedUserGroup?.users">
									{{user.userGroups?.length > 0 ? getUserGroupsNames(user).join(', ') : '-'}}
								</datatable-cell>
							</datatable-column>
						</datatable>
					</panel-body>
					<panel-footer>
						<span *ngIf="true">Select a User by clicking on a row in the table.</span>
					</panel-footer>
				</panel>
			</div>
		</div>
	</div>
</div>

<deletion-confirmation-modal #userGroupDeleteConfirm
							 [message]="'Are you sure you want to delete the \'' + selectedUserGroup?.name + '\' User Group?'"
							 [warning]="'All associated decisions made on Reservations, and all associated Resources will be removed as well! (Children Groups will be moved up.)'"
							 (confirm)="onDeleteUserGroup()">
</deletion-confirmation-modal>