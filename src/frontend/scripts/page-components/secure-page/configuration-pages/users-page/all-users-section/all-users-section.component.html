<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of AptiBook, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<div class="row">
	<div class="col-xs-12 col-md-8">
		<div class="btn-toolbar">
			<button class="btn btn-primary"
					(click)="onAddNewUser()">Add New User
			</button>
		</div>
		<hr/>
		<datatable [selectableRows]="true"
				   [bodyHeight]="'calc(100vh - 475px)'">
			<datatable-column [orderable]="false"
							  [width]="'30px'">
				<datatable-cell *ngFor="let user of users">
					<user-image [user]="user"
								[width]="'30px'">
					</user-image>
				</datatable-cell>
			</datatable-column>
			<datatable-column [title]="'Email Address'">
				<datatable-cell *ngFor="let user of users"
								(selected)="onUserSelected(user)"
								(deselected)="onUserDeselected(user)">
					{{user.emailAddress}}
				</datatable-cell>
			</datatable-column>
			<datatable-column [title]="'First Name'">
				<datatable-cell *ngFor="let user of users">
					{{user.firstName}}
				</datatable-cell>
			</datatable-column>
			<datatable-column [title]="'Last Name'">
				<datatable-cell *ngFor="let user of users">
					{{user.lastName}}
				</datatable-cell>
			</datatable-column>
			<datatable-column [title]="'Assigned User Groups'">
				<datatable-cell *ngFor="let user of users">
					{{getUserGroupsNames(user).join(', ')}}
				</datatable-cell>
			</datatable-column>
		</datatable>
	</div>
	<div class="col-xs-12 col-md-4">
		<panel id="selected-user-panel"
			   [class.has-footer]="selectedUser"
			   [type]="'primary'"
			   [title]="'User Information'">
			<panel-body>
				<div *ngIf="!selectedUser">
					<h4>Select a User by clicking on a row in the table.</h4>
				</div>
				<div *ngIf="selectedUser">
					<user-image [width]="'130px'">
					</user-image>
					<div id="user-info">
						<form-group [control]="selectedUserPersonalInformation?.controls['emailAddress']"
									[label]="'Email Address'"
									[faIconName]="'at'"
									[errorMessages]="
                                    {
                                    pattern: 'These characters are not allowed:  < > ; =',
                                    maxlength: 'This must be 30 characters or less.'
                                    }">
						</form-group>
						
						<form-group [control]="selectedUserPersonalInformation?.controls['firstName']"
									[label]="'First Name'"
									[errorMessages]="
                                    {
                                    pattern: 'These characters are not allowed:  < > ; =',
                                    maxlength: 'This must be 30 characters or less.'
                                    }">
						</form-group>
						
						<form-group [control]="selectedUserPersonalInformation?.controls['lastName']"
									[label]="'Last Name'"
									[errorMessages]="
									{
									pattern: 'These characters are not allowed:  < > ; =',
									maxlength: 'This must be 30 characters or less.'
									}">
						</form-group>
						
						<form-group [control]="selectedUserPersonalInformation?.controls['phoneNumber']"
									[label]="'Phone Number'"
									[faIconName]="'phone'"
									[errorMessages]="
                                    {
                                    pattern: 'These characters are not allowed:  < > ; =',
                                    maxlength: 'This must be 30 characters or less.'
                                    }">
						</form-group>
						
						<form-group [control]="selectedUserPersonalInformation?.controls['location']"
									[label]="'Location'"
									[faIconName]="'map-marker'"
									[errorMessages]="
                                    {
                                    pattern: 'These characters are not allowed:  < > ; =',
                                    maxlength: 'This must be 250 characters or less.'
                                    }">
						</form-group>
					</div>
				</div>
			</panel-body>
			<panel-footer *ngIf="selectedUser">
				<button class="btn btn-default"
						*ngIf="!editingSelectedUser"
						(click)="onStartEditingUser()">
					Edit User
				</button>
				<button class="btn btn-primary"
						*ngIf="editingSelectedUser"
						(click)="onSaveUserChanges()"
						[disabled]="selectedUserPersonalInformation.invalid">
					Save Changes
				</button>
				<button class="btn btn-default"
						*ngIf="editingSelectedUser"
						(click)="onCancelEditingUser()">
					Cancel
				</button>
				<button class="btn btn-danger pull-right"
						[disabled]="isSelectedUserCurrentUser()"
						(click)="userDeleteModal.open()">
					Delete User
				</button>
			</panel-footer>
		</panel>
	</div>
</div>

<deletion-confirmation-modal #userDeleteModal
							 [message]="'Are you sure you want to delete the User \'' + selectedUser?.emailAddress + '\'?'"
							 [warning]="'All Reservations made by this User will also be deleted!'"
							 (confirm)="onDeleteSelectedUser()">
</deletion-confirmation-modal>
